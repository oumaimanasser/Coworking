<div class="reservation-container">
  <div class="header">
    <h1><i class="fas fa-calendar-check"></i> Réservation de Salle</h1>
    <p>Créez votre créneau personnalisé en choisissant directement vos horaires</p>
  </div>

  <div class="content">
    <div class="loading-overlay" *ngIf="isLoading">
      <div class="loading-spinner"></div>
      <p>Traitement en cours...</p>
    </div>

    <!-- Sélection de la salle -->
    <div class="form-section">
      <h2><i class="fas fa-building"></i> Sélectionnez une salle</h2>
      <div class="form-group">
        <label for="salleSelect">Choisir une salle *</label>
        <select id="salleSelect" class="form-input" [(ngModel)]="selectedSalle"
                (change)="onSalleChange()" [disabled]="isLoading" required>
          <option [ngValue]="null">Sélectionnez une salle</option>
          <option *ngFor="let salle of salles" [ngValue]="salle.id">
            {{ salle.nom }} ({{ salle.capacite }} personnes) - {{ salle.prix | currency:'EUR' }}
          </option>
        </select>
      </div>
    </div>

    <!-- Détails de la salle sélectionnée -->
    <div class="salle-info" *ngIf="selectedSalle">
      <h3><i class="fas fa-info-circle"></i> Détails de la salle:</h3>
      <div class="salle-details-card">
        <p><strong>Nom:</strong> {{ getSelectedSalleName() }}</p>
        <p><strong>Capacité:</strong> {{ getSelectedSalleCapacite() }} personnes</p>
        <p><strong>Prix:</strong> {{ getSelectedSallePrix() | currency:'EUR' }}</p>
      </div>
    </div>

    <!-- Nombre de personnes -->
    <div class="form-section" *ngIf="selectedSalle">
      <h2><i class="fas fa-users"></i> Nombre de personnes</h2>
      <div class="form-group">
        <label for="nombrePersonnes">Nombre de personnes *</label>
        <input id="nombrePersonnes" type="number" class="form-input"
               [(ngModel)]="nombrePersonnes"
               (change)="onNombrePersonnesChange()"
               [min]="1"
               [max]="getSelectedSalleCapacite()"
               required>
        <span class="capacity-info" *ngIf="selectedSalle">
          Capacité maximale: {{ getSelectedSalleCapacite() }} personnes
        </span>
      </div>
    </div>

    <!-- Créneau personnalisé -->
    <div class="form-section" *ngIf="selectedSalle">
      <h2><i class="fas fa-magic"></i> Créneau personnalisé</h2>
      <div class="personnalise-form">
        <div class="form-row">
          <div class="form-group">
            <label>Date et heure de début *</label>
            <input type="datetime-local" class="form-input"
                   [(ngModel)]="creneauPersonnalise.debut"
                   [min]="getTodayDate() + 'T00:00'"
                   (change)="onCreneauChange()">
          </div>
          <div class="form-group">
            <label>Date et heure de fin *</label>
            <input type="datetime-local" class="form-input"
                   [(ngModel)]="creneauPersonnalise.fin"
                   [min]="getTodayDate() + 'T00:00'"
                   (change)="onCreneauChange()">
          </div>
        </div>
      </div>
    </div>

    <!-- Résumé de la sélection -->
    <div class="selection-summary" *ngIf="creneauPersonnalise.debut && creneauPersonnalise.fin && selectedSalle">
      <h3><i class="fas fa-check-circle"></i> Créneau sélectionné</h3>
      <div class="summary-card">
        <p><strong>Salle:</strong> {{ getSelectedSalleName() }}</p>
        <p><strong>Prix:</strong> {{ getSelectedSallePrix() | currency:'EUR' }}</p>
        <p><strong>Nombre de personnes:</strong> {{ nombrePersonnes }}</p>
        <p><strong>Début:</strong> {{ formatDisplayDate(creneauPersonnalise.debut) }}</p>
        <p><strong>Fin:</strong> {{ formatDisplayDate(creneauPersonnalise.fin) }}</p>
        <p class="personnalise-badge">
          <i class="fas fa-star"></i> Créneau personnalisé
        </p>
      </div>
    </div>

    <!-- Messages d'erreur -->
    <div class="message error" *ngIf="showErrorMessage && errorText">
      <i class="fas fa-exclamation-circle"></i>
      <p>{{ errorText }}</p>
    </div>

    <!-- Message de confirmation -->
    <div class="message success" *ngIf="showConfirmation">
      <i class="fas fa-check-circle"></i>
      <div class="message-content">
        <h3>✅ Réservation confirmée!</h3>
        <p>Votre réservation a été effectuée avec succès.</p>
        <div class="confirmation-details">
          <p><strong>Salle:</strong> {{ getSelectedSalleName() }}</p>
          <p><strong>Prix:</strong> {{ getSelectedSallePrix() | currency:'EUR' }}</p>
          <p><strong>Date:</strong> {{ formatDisplayDate(selectedCreneau?.debut) }}</p>
          <p><strong>Durée:</strong> {{ formatDisplayDate(selectedCreneau?.debut) }} - {{ formatDisplayDate(selectedCreneau?.fin) }}</p>
          <p><strong>Nombre de personnes:</strong> {{ nombrePersonnes }}</p>
        </div>
        <p *ngIf="currentUser?.email">
          Un email de confirmation a été envoyé à <strong>{{ currentUser?.email }}</strong>
        </p>
        <button class="new-reservation-btn" (click)="resetForm()">
          <i class="fas fa-plus"></i> Nouvelle réservation
        </button>
      </div>
    </div>

    <!-- Bouton de réservation -->
    <div class="action-buttons" *ngIf="!showConfirmation">
      <button class="submit-btn" [disabled]="!canReserve() || isLoading" (click)="reserver()">
        <i class="fas" [class.fa-spinner]="isLoading" [class.fa-pulse]="isLoading"
           [class.fa-calendar-check]="!isLoading"></i>
        {{ isLoading ? 'Traitement...' : 'Confirmer la réservation' }}
      </button>
    </div>
  </div>
</div>
