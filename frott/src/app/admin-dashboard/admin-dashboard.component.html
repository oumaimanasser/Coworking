<div class="dashboard-container">
  <!-- ===== HEADER ===== -->
  <div class="header">
    <h1><i class="fas fa-tachometer-alt"></i> Admin Dashboard</h1>
    <p>Gestion complète de votre système de réservation</p>
  </div>

  <!-- ===== NAVIGATION ===== -->
  <div class="nav-container" *ngIf="currentPage !== 'login'">
    <div class="nav-buttons">
      <button class="nav-btn" [class.active]="currentPage === 'dashboard'" (click)="showPage('dashboard')">
        <i class="fas fa-chart-pie"></i> Dashboard
      </button>
      <button class="nav-btn" [class.active]="currentPage === 'reservations'" (click)="showPage('reservations')">
        <i class="fas fa-calendar-check"></i> Réservations
      </button>
      <button class="nav-btn" [class.active]="currentPage === 'creneaux'" (click)="showPage('creneaux')">
        <i class="fas fa-clock"></i> Créneaux
      </button>
      <button class="nav-btn" [class.active]="currentPage === 'salles'" (click)="showPage('salles')">
        <i class="fas fa-building"></i> Salles
      </button>
      <button class="nav-btn" [class.active]="currentPage === 'paiements'" (click)="showPage('paiements')">
        <i class="fas fa-credit-card"></i> Paiements
      </button>
      <button class="nav-btn" [class.active]="currentPage === 'users'" (click)="showPage('users')">
        <i class="fas fa-users"></i> Utilisateurs
      </button>
      <button class="nav-btn" (click)="logout()">
        <i class="fas fa-sign-out-alt"></i> Déconnexion
      </button>
    </div>
  </div>

  <!-- ===== LOGIN PAGE ===== -->
  <div *ngIf="currentPage === 'login'" class="page-content">
    <h2><i class="fas fa-user-lock"></i> Connexion Admin</h2>
    <form [formGroup]="loginForm" (ngSubmit)="login()" class="form-container">
      <div class="form-group">
        <label for="login-email">Email</label>
        <input id="login-email" type="email" formControlName="email" class="form-input" placeholder="Email" />
      </div>
      <div class="form-group">
        <label for="login-password">Mot de passe</label>
        <input id="login-password" type="password" formControlName="password" class="form-input" placeholder="Mot de passe" />
      </div>
      <div class="form-group">
        <label for="login-resetEmail">Email pour réinitialisation</label>
        <input id="login-resetEmail" [(ngModel)]="resetEmail" class="form-input" placeholder="Entrez votre email" />
      </div>
      <div class="form-group">
        <label for="login-newPassword">Nouveau mot de passe</label>
        <input id="login-newPassword" [(ngModel)]="newPassword" type="password" class="form-input" placeholder="Nouveau mot de passe" />
      </div>
      <button type="button" (click)="resetPasswordRequest()">Demander réinitialisation</button>
      <button type="button" (click)="submitResetPassword()" [disabled]="!resetToken || !newPassword">Réinitialiser mot de passe</button>
      <button type="submit" class="submit-btn" [disabled]="!loginForm.valid">Se connecter</button>
    </form>
  </div>

  <!-- ===== DASHBOARD PAGE ===== -->
  <div *ngIf="currentPage === 'dashboard'" class="page-content">
    <div class="stats-container">
      <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-calendar-check"></i></div>
        <div class="stat-info">
          <h3>{{ getTotalReservations() }}</h3>
          <p>Total Réservations</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-clock"></i></div>
        <div class="stat-info">
          <h3>{{ getTotalCreneaux() }}</h3>
          <p>Total Créneaux</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-building"></i></div>
        <div class="stat-info">
          <h3>{{ getTotalSalles() }}</h3>
          <p>Total Salles</p>
        </div>
      </div>
    </div>
    <div class="section-header">
      <h2><i class="fas fa-calendar-check"></i> Dernières Réservations</h2>
    </div>
    <div class="table-container">
      <table class="data-table">
        <thead>
        <tr>
          <th>Client</th>
          <th>Salle</th>
          <th>Créneau</th>
          <th>Personnes</th>
          <th>Date Réservation</th>
          <th>Statut</th>
          <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let r of getRecentReservations()">
          <td>{{ r.clientName }}</td>
          <td>{{ r.salle?.nom || 'Indisponible' }}</td>
          <td>{{ formatDate(r.creneau?.debut) }} - {{ formatDate(r.creneau?.fin) }}</td>
          <td>{{ r.nombrePersonnes || 1 }}</td>
          <td>{{ formatDate(r.dateReservation) }}</td>
          <td>
              <span class="status-badge" [ngClass]="getPaiementStatusClass(r.paiementStatus)">
                {{ getPaiementStatusText(r.paiementStatus) }}
              </span>
          </td>
          <td>
            <div class="action-buttons">
              <button class="action-btn delete-btn" (click)="annulerReservation(r.id)">
                <i class="fas fa-times"></i> Annuler
              </button>
            </div>
          </td>
        </tr>
        <tr *ngIf="getRecentReservations().length === 0">
          <td colspan="7" class="no-data">Aucune réservation récente</td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- ===== RÉSERVATIONS PAGE ===== -->
  <div *ngIf="currentPage === 'reservations'" class="page-content">
    <div class="section-header">
      <h2><i class="fas fa-calendar-check"></i> Gestion des Réservations</h2>
    </div>
    <div class="table-container">
      <table class="data-table">
        <thead>
        <tr>
          <th>Client</th>
          <th>Salle</th>
          <th>Créneau</th>
          <th>Personnes</th>
          <th>Date Réservation</th>
          <th>Statut</th>
          <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let r of reservations">
          <td>{{ r.clientName }}</td>
          <td>{{ r.salle?.nom || 'Indisponible' }}</td>
          <td>{{ formatDate(r.creneau?.debut) }} - {{ formatDate(r.creneau?.fin) }}</td>
          <td>{{ r.nombrePersonnes || 1 }}</td>
          <td>{{ formatDate(r.dateReservation) }}</td>
          <td>
              <span class="status-badge" [ngClass]="getPaiementStatusClass(r.paiementStatus)">
                {{ getPaiementStatusText(r.paiementStatus) }}
              </span>
          </td>
          <td>
            <div class="action-buttons">
              <button class="action-btn delete-btn" (click)="annulerReservation(r.id)">
                <i class="fas fa-times"></i> Annuler
              </button>
            </div>
          </td>
        </tr>
        <tr *ngIf="reservations.length === 0">
          <td colspan="7" class="no-data">Aucune réservation</td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- ===== CRÉNEAUX PAGE ===== -->
  <div *ngIf="currentPage === 'creneaux'" class="page-content">
    <div class="section-header">
      <h2><i class="fas fa-clock"></i> Gestion des Créneaux</h2>
    </div>
    <form [formGroup]="newCreneauForm" (ngSubmit)="addCreneau()" class="form-container">
      <div class="form-row">
        <div class="form-group">
          <label for="creneaux-debut">Date et heure de début</label>
          <input id="creneaux-debut" type="datetime-local" formControlName="debut" class="form-input" />
        </div>
        <div class="form-group">
          <label for="creneaux-fin">Date et heure de fin</label>
          <input id="creneaux-fin" type="datetime-local" formControlName="fin" class="form-input" />
        </div>
        <div class="form-group">
          <label for="creneaux-salleId">Salle</label>
          <select id="creneaux-salleId" formControlName="salleId" class="form-input">
            <option value="">Sélectionnez une salle</option>
            <option *ngFor="let salle of salles" [value]="salle.id">{{ salle.nom }}</option>
          </select>
        </div>
      </div>
      <div class="action-buttons">
        <button type="submit" class="submit-btn" [disabled]="!newCreneauForm.valid">Ajouter Créneau</button>
      </div>
    </form>
    <div class="creneaux-list">
      <div class="creneau-item" *ngFor="let c of creneaux">
        <div class="creneau-info">
          <p><strong>Salle:</strong> {{ c.salle?.nom || 'Indisponible' }}</p>
          <p><strong>Début:</strong> {{ formatDate(c.debut) }}</p>
          <p><strong>Fin:</strong> {{ formatDate(c.fin) }}</p>
        </div>
        <div class="action-buttons">
          <button class="action-btn edit-btn" (click)="editCreneau(c)">Modifier</button>
          <button class="action-btn delete-btn" (click)="deleteCreneau(c.id)">Supprimer</button>
        </div>
      </div>
      <div *ngIf="creneaux.length === 0" class="no-data">Aucun créneau</div>
    </div>
    <div *ngIf="editingCreneau" class="form-container">
      <h3>Modifier Créneau</h3>
      <form [formGroup]="editCreneauForm" (ngSubmit)="updateCreneau()">
        <div class="form-row">
          <div class="form-group">
            <label for="creneaux-editDebut">Date et heure de début</label>
            <input id="creneaux-editDebut" type="datetime-local" formControlName="debut" class="form-input" />
          </div>
          <div class="form-group">
            <label for="creneaux-editFin">Date et heure de fin</label>
            <input id="creneaux-editFin" type="datetime-local" formControlName="fin" class="form-input" />
          </div>
          <div class="form-group">
            <label for="creneaux-editSalleId">Salle</label>
            <select id="creneaux-editSalleId" formControlName="salleId" class="form-input">
              <option value="">Sélectionnez une salle</option>
              <option *ngFor="let salle of salles" [value]="salle.id">{{ salle.nom }}</option>
            </select>
          </div>
        </div>
        <div class="action-buttons">
          <button type="submit" class="submit-btn" [disabled]="!editCreneauForm.valid">Mettre à jour</button>
          <button type="button" class="cancel-btn" (click)="cancelEdit()">Annuler</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ===== SALLES PAGE ===== -->
  <div *ngIf="currentPage === 'salles'" class="page-content">
    <div class="section-header">
      <h2><i class="fas fa-building"></i> Gestion des Salles</h2>
    </div>
    <form [formGroup]="newSalleForm" (ngSubmit)="addSalle()" class="form-container">
      <div class="form-row">
        <div class="form-group">
          <label for="salles-nom">Nom</label>
          <input id="salles-nom" formControlName="nom" class="form-input" placeholder="Nom de la salle" />
        </div>
        <div class="form-group">
          <label for="salles-capacite">Capacité</label>
          <input id="salles-capacite" type="number" formControlName="capacite" class="form-input" min="1" />
        </div>
        <div class="form-group">
          <label for="salles-prix">Prix (€)</label>
          <input id="salles-prix" type="number" formControlName="prix" class="form-input" min="0" step="0.01" />
        </div>
        <div class="form-group">
          <label for="salles-status">Statut</label>
          <select id="salles-status" formControlName="status" class="form-input">
            <option value="DISPONIBLE">Disponible</option>
            <option value="INDISPONIBLE">Indisponible</option>
            <option value="MAINTENANCE">Maintenance</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label for="salles-image">Image</label>
        <input id="salles-image" type="file" (change)="onFileSelected($event)" accept="image/*" class="form-input" />
      </div>
      <div class="action-buttons">
        <button type="submit" class="submit-btn" [disabled]="!newSalleForm.valid">Ajouter Salle</button>
      </div>
    </form>
    <div class="salles-list">
      <div class="salle-item" *ngFor="let s of salles">
        <div class="salle-info">
          <img [src]="getImageUrl(s.imagePath)" (error)="onImageError($event)" alt="Salle Image" style="max-width: 100px; border-radius: 8px;" *ngIf="s.imagePath" />
          <p><strong>Nom:</strong> {{ s.nom }}</p>
          <p><strong>Capacité:</strong> {{ s.capacite }} personnes</p>
          <p><strong>Prix:</strong> {{ s.prix | currency:'EUR' }}</p>
          <p><strong>Statut:</strong> <span class="status-badge" [ngClass]="getStatusClass(s.status)">{{ s.status }}</span></p>
        </div>
        <div class="action-buttons">
          <button class="action-btn edit-btn" (click)="editSalle(s)">Modifier</button>
          <button class="action-btn delete-btn" (click)="deleteSalle(s.id)">Supprimer</button>
        </div>
      </div>
      <div *ngIf="salles.length === 0" class="no-data">Aucune salle</div>
    </div>
    <div *ngIf="editingSalle" class="form-container">
      <h3>Modifier Salle</h3>
      <form [formGroup]="editSalleForm" (ngSubmit)="updateSalle()">
        <div class="form-row">
          <div class="form-group">
            <label for="salles-editNom">Nom</label>
            <input id="salles-editNom" formControlName="nom" class="form-input" placeholder="Nom de la salle" />
          </div>
          <div class="form-group">
            <label for="salles-editCapacite">Capacité</label>
            <input id="salles-editCapacite" type="number" formControlName="capacite" class="form-input" min="1" />
          </div>
          <div class="form-group">
            <label for="salles-editPrix">Prix (€)</label>
            <input id="salles-editPrix" type="number" formControlName="prix" class="form-input" min="0" step="0.01" />
          </div>
          <div class="form-group">
            <label for="salles-editStatus">Statut</label>
            <select id="salles-editStatus" formControlName="status" class="form-input">
              <option value="DISPONIBLE">Disponible</option>
              <option value="INDISPONIBLE">Indisponible</option>
              <option value="MAINTENANCE">Maintenance</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label for="salles-editImage">Nouvelle Image</label>
          <input id="salles-editImage" type="file" (change)="onFileSelected($event)" accept="image/*" class="form-input" />
        </div>
        <div class="action-buttons">
          <button type="submit" class="submit-btn" [disabled]="!editSalleForm.valid">Mettre à jour</button>
          <button type="button" class="cancel-btn" (click)="cancelEdit()">Annuler</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ===== PAIEMENTS PAGE ===== -->
  <div *ngIf="currentPage === 'paiements'" class="page-content">
    <div class="section-header">
      <h2><i class="fas fa-credit-card"></i> Gestion des Paiements</h2>
    </div>

    <!-- Paiements en attente -->
    <div class="payment-section">
      <h3><i class="fas fa-clock"></i> Paiements en attente</h3>
      <div class="table-container">
        <table class="data-table">
          <thead>
          <tr>
            <th>Client</th>
            <th>Salle</th>
            <th>Créneau</th>
            <th>Personnes</th>
            <th>Date Réservation</th>
            <th>Statut Paiement</th>
            <th>Actions</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let r of reservationsAvecPaiementEnAttente">
            <td>{{ r.clientName }}</td>
            <td>{{ r.salle?.nom || 'Indisponible' }}</td>
            <td>{{ formatDate(r.creneau?.debut) }} - {{ formatDate(r.creneau?.fin) }}</td>
            <td>{{ r.nombrePersonnes || 1 }}</td>
            <td>{{ formatDate(r.dateReservation) }}</td>
            <td>
                <span class="status-badge" [ngClass]="getPaiementStatusClass(r.paiementStatus)">
                  {{ getPaiementStatusText(r.paiementStatus) }}
                </span>
            </td>
            <td>
              <div class="action-buttons">
                <button class="action-btn confirm-btn" (click)="confirmerPaiement(r.id)">
                  <i class="fas fa-check"></i> Confirmer
                </button>
                <button class="action-btn delete-btn" (click)="annulerPaiement(r.id)">
                  <i class="fas fa-times"></i> Annuler
                </button>
              </div>
            </td>
          </tr>
          <tr *ngIf="reservationsAvecPaiementEnAttente.length === 0">
            <td colspan="7" class="no-data">Aucun paiement en attente</td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Paiements confirmés -->
    <div class="payment-section">
      <h3><i class="fas fa-check-circle"></i> Paiements confirmés</h3>
      <div class="table-container">
        <table class="data-table">
          <thead>
          <tr>
            <th>Client</th>
            <th>Salle</th>
            <th>Créneau</th>
            <th>Personnes</th>
            <th>Date Réservation</th>
            <th>Statut Paiement</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let r of reservationsPayees">
            <td>{{ r.clientName }}</td>
            <td>{{ r.salle?.nom || 'Indisponible' }}</td>
            <td>{{ formatDate(r.creneau?.debut) }} - {{ formatDate(r.creneau?.fin) }}</td>
            <td>{{ r.nombrePersonnes || 1 }}</td>
            <td>{{ formatDate(r.dateReservation) }}</td>
            <td>
                <span class="status-badge" [ngClass]="getPaiementStatusClass(r.paiementStatus)">
                  {{ getPaiementStatusText(r.paiementStatus) }}
                </span>
            </td>
          </tr>
          <tr *ngIf="reservationsPayees.length === 0">
            <td colspan="6" class="no-data">Aucun paiement confirmé</td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- ===== USERS PAGE ===== -->
  <div *ngIf="currentPage === 'users'" class="page-content">
    <div class="section-header">
      <h2><i class="fas fa-users"></i> Gestion des Utilisateurs</h2>
    </div>
    <form [formGroup]="newUserForm" (ngSubmit)="addUser()" class="form-container">
      <div class="form-row">
        <div class="form-group">
          <label for="users-username">Nom d'utilisateur</label>
          <input id="users-username" formControlName="username" class="form-input" placeholder="Nom d'utilisateur" />
        </div>
        <div class="form-group">
          <label for="users-email">Email</label>
          <input id="users-email" type="email" formControlName="email" class="form-input" placeholder="Email" />
        </div>
        <div class="form-group">
          <label for="users-password">Mot de passe</label>
          <input id="users-password" type="password" formControlName="password" class="form-input" placeholder="Mot de passe" />
        </div>
      </div>
      <div class="action-buttons">
        <button type="submit" class="submit-btn" [disabled]="!newUserForm.valid">Ajouter Utilisateur</button>
      </div>
    </form>
    <div class="users-list">
      <div class="user-item" *ngFor="let u of users">
        <div class="user-info">
          <p><strong>Nom:</strong> {{ u.username }}</p>
          <p><strong>Email:</strong> {{ u.email }}</p>
          <p><strong>Rôles:</strong> {{ getUserRolesDisplay(u) }}</p>
        </div>
        <div class="action-buttons">
          <button class="action-btn edit-btn" (click)="editUser(u)">Modifier</button>
          <button class="action-btn delete-btn" (click)="deleteUser(u.id)">Supprimer</button>
        </div>
      </div>
      <div *ngIf="users.length === 0" class="no-data">Aucun utilisateur</div>
    </div>
    <div *ngIf="editingUser" class="form-container">
      <h3>Modifier Utilisateur</h3>
      <form [formGroup]="editUserForm" (ngSubmit)="updateUser()">
        <div class="form-row">
          <div class="form-group">
            <label for="users-editUsername">Nom d'utilisateur</label>
            <input id="users-editUsername" formControlName="username" class="form-input" placeholder="Nom d'utilisateur" />
          </div>
          <div class="form-group">
            <label for="users-editEmail">Email</label>
            <input id="users-editEmail" type="email" formControlName="email" class="form-input" placeholder="Email" />
          </div>
          <div class="form-group">
            <label for="users-editPassword">Nouveau mot de passe (optionnel)</label>
            <input id="users-editPassword" type="password" formControlName="password" class="form-input" placeholder="Nouveau mot de passe" />
          </div>
        </div>
        <div class="action-buttons">
          <button type="submit" class="submit-btn" [disabled]="!editUserForm.valid">Mettre à jour</button>
          <button type="button" class="cancel-btn" (click)="cancelEdit()">Annuler</button>
        </div>
      </form>
    </div>
  </div>
</div>
